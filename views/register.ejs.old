<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="static/js/jquery-1.12.4.min.js"></script>
	<script src="static/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="static/css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">

	<!--google fonts-->
	<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="static/css/slick.css"/>
	<link rel="stylesheet" type="text/css" href="static/css/style.css">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="static/js/slick.min.js"></script>
 	<title>FITTED web <%= app_version %></title>
</head>
<body>
<!--facebook code-->
<script>
$(document).ready(function(){

function checkLoginState() {
	FB.login(function(response){
		console.log(response);
	});
}

window.fbAsyncInit = function() {
	FB.init({
	  appId      : '672245366249588',
	  xfbml      : true,
	  version    : 'v2.6'
	});

	var user_id, accessToken, signedRequest, expiresIn;

	FB.getLoginStatus(function(response){
		accessToken = response.authResponse.accessToken;
		user_id = response.authResponse.userID;
		signedRequest = response.authResponse.signedRequest;
		expiresIn = response.authResponse.expiresIn;

		FB.api("/" + user_id + "/", function(response){
			console.log(response);
		})

		//Once we're logged in do more!
		//Need to condense this into a batch request
		FB.api("/" + user_id + "/picture?width=9999", 
			function(response){
				if (response && !response.error) {
	        		document.getElementById("reg-user-profile-image").src = response.data.url;
	      		}
			}
		);

		//First name
		FB.api('/' + user_id + "?fields=first_name&accessToken=" + accessToken,
		function(response){
			if(response && !response.error) {
				$("#inp_firstName").val(response.first_name);
				}
			}
		);

		//Last name
		FB.api('/' + user_id + "?fields=last_name&accessToken=" + accessToken,
		function(response){
			if(response && !response.error) {
				$("#inp_lastName").val(response.last_name);
				}
			}
		);

		//Birthday
		FB.api('/' + user_id + "?fields=birthday&accessToken=" + accessToken,
		function(response){
			if(response && !response.error) {
				$("#reg_birthday").val(response.birthday);
				}
			}
		);

		FB.api('/' + user_id + "?fields=location&accessToken=" + accessToken,
		function(response){
			if(response && !response.error) {
				//response.location object has an id value which we can find
				//out more information from.
				//revisit this later
				$("#reg_location").val(response.location.name);
				$("#reg_distance").val("10 mi");
				}
			}
		);

	});
};

(function(d, s, id){
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) {return;}
 js = d.createElement(s); js.id = id;
 js.src = "static/js/facebook-sdk.js";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
});
</script>

<body>
<script>
	var user_id = <%=user.id%>;
	//getProfilePicture(user_id);
</script>

<div align="center">
<br>
<h1>FITTED</h1>
<br>
<div class="reg-user-profile">
	<img id="reg-user-profile-image">
</div>

<div class="register-slick">
	<div>
		<div class="blurb-container">
			<h1>
				<span style="font-size: 28px;">Welcome, <%= user.displayName %>!</span><br><br>
				<p>To finish setting up your account, we'll need to know a few more things about you.</p>
			</h1>
		</div><br>
		<button class="btn fitted_button slick-next">That's fine</button>
	</div>

	<div>
		<div class="blurb-container">
			<div class="input-group reg-group">
				<span class="input-group-addon reg-group-inp">
					<h1>First Name</h1>
				</span>
				<input type="text" class="form-control regInp_age" placeholder="Mary" id="inp_firstName">
			</div>
			<div class="input-group">
				<span class="input-group-addon reg-group-inp">
					<h1>Last Name</h1>
				</span>
				<input type="text" class="form-control regInp_age" placeholder="Sue" id="inp_lastName">
			</div><br>
			<h1>My birthday is</h1>
			<input type="text" class="regInp_age" id="reg_birthday" style="text-align:center;" placeholder="01/01/1900">
			<br><br>
			<p>
				<h1>Is this correct?</h1><br>
				<button class="btn fitted_button slick-next">Yes, continue</button><br>
				<span style="font-size: 12px;" class="slick-prev">
					Back
				</span>
			</p>
		</div>
	</div>

	<div>
		<div class="blurb-container">
			<h1>Your Location</h1>
			<input type="text" class="regInp_age" id="reg_location" style="text-align:center;" placeholder="Ann Arbor, Michigan"><br>
			<br><h1>Travel Range</h1>
			<input type="text" class="regInp_age" id="reg_distance" style="text-align:center;" placeholder="10 mi"><Br><br>

			<h1>These will affect what is initially offered for you.</h1>
			<!--<div id="map" style="width:400px; height: 260px;"></div>
			<script>
			function initMap() {
			var mapDiv = document.getElementById('map');
			var map = new google.maps.Map(mapDiv, {
			    center: {lat: 44.540, lng: -78.546},
			    zoom: 8
			});
			}
			</script>
			<script
			async defer
				src ="https://maps.googleapis.com/maps/api/js?key=AIzaSyDt1IP6Z5Y5UQJRA4hJyLf0hm4BqGc467A&callback=initMap">	
			</script>-->
			<p><br>
			<h1>Is this correct?</h1><br>
			<!--<button class="btn fitted_button slick-next">Yes, continue</button><br>-->
			<button class="btn fitted_button" id="reg_completed">Complete</button><br>
			<span style="font-size: 12px;" class="slick-prev">
				Back
			</span>
			</p>
		</div>
	</div>

	<!--<div><br>
		<h1>Are You...</h1><br>
		<button type="button" class="btn btn-primary reg-user-type" data-toggle="button" aria-pressed="false" autocomplete="off">
			<h1 style="color: #2b2b2b; font-size: 28px;">A Student</h1>
			Students can get started right away!
		</button><br>
		<button type="button" class="btn btn-primary reg-user-type" id="reg_instructor" data-toggle="button" aria-pressed="false" autocomplete="off">
			<h1 style="color: #2b2b2b; font-size: 28px;">An Instructor</h1>
			Instructors will have to verify with us.
		</button>
		<p><br>
			<h1>Is this correct?</h1><br>
			<button class="btn fitted_button" id="reg_completed">Complete</button><br>
			<span style="font-size: 12px;" class="slick-prev">
				Back
			</span>
		</p>
	</div>-->
</div>

<script>
	$(document).ready(function(){
		$('.register-slick').slick({arrows: false, infinite: false, draggable: false});

		$(".slick-next").mouseup(function(){
			$('.register-slick').slick("slickNext");
		});
		$(".slick-prev").mouseup(function(){
			$('.register-slick').slick("slickPrev");
		});

		$("#reg_completed").mouseup(function(){
			var reg_data = {
				"data": {
					"first_name": $('#inp_firstName').val(),
					"last_name": $('#inp_lastName').val(),
					"birthday": $('#reg_birthday').val(),
					"location": $('#reg_location').val(),
					"travel_range": $('#reg_distance').val(),
				},
			}
			//POST it
			$.ajax({
				type: "POST",
				url: "/regcomplete",
				data: JSON.stringify(reg_data),
				contentType: 'application/json',
				dataType: 'json',
				processData: false,
				contentType: "application/json; charset=utf-8",
				complete: function(data){
					window.location.replace('/account');
				}
			});
		});
	});
</script>

</div>
</body>
</html>