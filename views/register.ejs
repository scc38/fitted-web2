<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width; initial-scale = 1.0; maximum-scale=1.0; user-scalable=no" />
	<script src="static/js/jquery-1.12.4.min.js"></script>
	<script src="static/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="static/css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">

	<!--google fonts-->
	<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="static/css/slick.css"/>
	<link rel="stylesheet" type="text/css" href="static/css/style.css">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="static/js/slick.min.js"></script>
 	<title>FITTED web <%= app_version %></title>

 	<script>
 	function isNumberKey(evt)
       {
          var charCode = (evt.which) ? evt.which : evt.keyCode;
          if (charCode != 46 && charCode > 31 
            && (charCode < 48 || charCode > 57))
             return false;

          return true;
       }
 	</script>
</head>
<body>
<!--facebook code-->
<script>
$(document).ready(function(){

function checkLoginState() {
	FB.login(function(response){
		//console.log(response);
	});
}

window.fbAsyncInit = function() {
	FB.init({
	  appId      : '672245366249588',
	  xfbml      : true,
	  version    : 'v2.6'
	});

	var user_id, accessToken, signedRequest, expiresIn;

	FB.getLoginStatus(function(response){
		accessToken = response.authResponse.accessToken;
		user_id = response.authResponse.userID;
		signedRequest = response.authResponse.signedRequest;
		expiresIn = response.authResponse.expiresIn;

		FB.api("/" + user_id + "/", function(response){
			//console.log(response);
		})

		//Once we're logged in do more!
		//Need to condense this into a batch request
		FB.api("/" + user_id + "/picture?width=9999", 
			function(response){
				if (response && !response.error) {
	        		document.getElementById("reg-user-profile-image").src = response.data.url;
	        		$(".reg-friend-img").attr('src', response.data.url);
	      		}
			}
		);

		/* 	request
			first_name
			last_name
			birthday
			location
		*/
		FB.api('/' + user_id + "?fields=first_name,last_name,birthday,location,email&accessToken=" + accessToken,
		function(response){
			if(response && !response.error) {
				//fill in inputs
				$('#reg_displayName').val(response.first_name + " " + response.last_name);
				$('#reg_email').val(response.email);

				//need to figure out the zip code stuff...complicated?

				//birthday
				var bday = response.birthday;
				bday = bday.split("/");
				$("#reg_bday_mm").val(bday[0]);
				$("#reg_bday_dd").val(bday[1]);
				$("#reg_bday_yyyy").val(bday[2]);
				}
			}
		);

	});
};

(function(d, s, id){
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) {return;}
 js = d.createElement(s); js.id = id;
 js.src = "static/js/facebook-sdk.js";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
});
</script>

<body>
<script>
	var user_id = <%=user.id%>;
	//getProfilePicture(user_id);
</script>

<div class="reg-header" align="center">
	<span style="width: 50%;display:inline-block;">
		Confirm or Edit Your Profile Details
	</span>
</div>
<div class="reg-user-profile-container" align="center">
	<div class="reg-user-profile">
		<img id="reg-user-profile-image">
	</div>
</div>

<div class="reg-body" align="center">
	<span>
		<button class="btn fitted_button fitted_button-selected">I'm a student</button><br>
		<button class="btn fitted_button">I'm an instructor</button>
	</span>
	<br><br>
	<div align="left">
		<div class="reg-inp-group">
			<div class="reg-inp-group-title">
				Name
			</div>
			<input type="text" class="regInp" placeholder="Olivia Coolio" id="reg_displayName">
		</div>
		<div class="reg-inp-group">
			<div class="reg-inp-group-title">
				Email
			</div>
			<input type="text" class="regInp" placeholder="olivia.culpo@gmail.com" id="reg_email">
		</div>
		<div class="reg-inp-group">
			<div class="reg-inp-group-title">
				Location (zip code)
			</div>
			<input type="text" class="regInp" placeholder="30307" value="30307" id="reg_location" onkeypress="return isNumberKey(event)" maxlength="15">
		</div>
		<div class="reg-inp-group">
			<div class="reg-inp-group-title">
				Birthday
			</div>
			<select class="selectMM" id="reg_bday_mm">
			 	<option value="01">January</option>
  				<option value="02">February</option>
  				<option value="03">March</option>
  				<option value="04">April</option>
  				<option value="05">May</option>
  				<option value="06">June</option>
  				<option value="07">July</option>
  				<option value="08">August</option>
  				<option value="09">September</option>
  				<option value="10">October</option>
  				<option value="11">November</option>
  				<option value="12">December</option>
			</select>

			<input type="text" class="regInp regInp-DD" placeholder="DD" id="reg_bday_dd" onkeypress="return isNumberKey(event)" maxlength="2">
			<input type="text" class="regInp regInp-YYYY" placeholder="YYYY" id="reg_bday_yyyy" onkeypress="return isNumberKey(event)" maxlength="4">
		</div>

		<div class="reg-inp-group">
			<div class="reg-inp-group-title">
				Friends on Fitted
			</div>
			<div class="reg-friend">
				<div class="reg-friend-icon">
					<img class='reg-friend-img'>
				</div>
				Sarah
			</div>
			<div class="reg-friend">
				<div class="reg-friend-icon">
					<img class='reg-friend-img'>
				</div>
				Becca
			</div>
			<div align="center">
				<button class="btn fitted_button slick-next">Invite your friends</button>
			</div>
		</div>
	</div>
</div>

<div class="reg-confirm" id="reg_completed">
	This is fine. Let's see classes
</div>


<script>
	$(document).ready(function(){

		$("#reg_completed").mouseup(function(){
			var bday_str = String($("#reg_bday_mm").val()) + "/" + String($("#reg_bday_dd").val()) + "/" + String($("#reg_bday_yyyy").val());
			var reg_data = {
				"data": {
					"display_name": $('#reg_displayName').val(),
					"email": $("#reg_email").val(),
					"birthday": bday_str,
					"location": $('#reg_location').val(),
					"isInstructor": false
				},
			}
			//POST it
			$.ajax({
				type: "POST",
				url: "/regcomplete",
				data: JSON.stringify(reg_data),
				contentType: 'application/json',
				dataType: 'json',
				processData: false,
				contentType: "application/json; charset=utf-8",
				complete: function(data){
					window.location.replace('/account');
				}
			});
		});
	});
</script>

</div>
</body>
</html>